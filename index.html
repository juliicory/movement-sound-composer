<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GY-87 IMU ‚Üí Tone.js (USB)</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
  <link rel="stylesheet" href="GY-87.css">
  <style>
    .tone-section {
      margin-top: 15px;
      padding: 10px;
      background: rgba(0, 255, 0, 0.1);
      border-left: 3px solid #00ff00;
    }
    .tone-control {
      margin: 8px 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .tone-control label {
      min-width: 120px;
      color: #00ff00;
      font-weight: bold;
    }
    .tone-control input {
      flex: 1;
      max-width: 200px;
      background: rgba(0, 255, 0, 0.2);
      border: 1px solid #00ff00;
      color: #00ff00;
      padding: 5px;
    }
    .tone-control input::-webkit-slider-thumb {
      background: #00ff00;
    }
    button {
      background: #00ff00;
      color: #000;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      margin: 5px 5px 5px 0;
    }
    button:hover {
      background: #00dd00;
    }
    .code-example {
      background: rgba(0, 100, 0, 0.3);
      border: 1px solid #00ff00;
      padding: 10px;
      margin: 10px 0;
      font-family: monospace;
      color: #00ff00;
      font-size: 12px;
      white-space: pre-wrap;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <h1>üéµ GY-87 IMU ‚Üí Tone.js (USB)</h1>
  
  <div class="container">
    <h3>1. Connect Arduino via USB</h3>
    <div class="note">
      ‚ö†Ô∏è <strong>Chrome/Edge only!</strong> WebSerial requires Chrome or Edge browser.<br>
      Make sure Arduino is plugged in via USB cable.
    </div>
    <button id="connectBtn" onclick="connectSerial()">Connect to Arduino</button>
    <div id="status" class="status disconnected">Not connected</div>
  </div>

  <div class="container">
    <h3>2. Live Sensor Data</h3>
    
    <div class="sensor-section">
      <div class="sensor-title">ACCELEROMETER (g-force)</div>
      <div class="data">
        <div class="data-item">
          <div class="data-label">X Axis</div>
          <div class="data-value" id="accelX">0.00</div>
        </div>
        <div class="data-item">
          <div class="data-label">Y Axis</div>
          <div class="data-value" id="accelY">0.00</div>
        </div>
        <div class="data-item">
          <div class="data-label">Z Axis</div>
          <div class="data-value" id="accelZ">0.00</div>
        </div>
        <div class="data-item">
          <div class="data-label">Magnitude</div>
          <div class="data-value" id="accelMag">0.00</div>
        </div>
      </div>
    </div>

    <div class="sensor-section">
      <div class="sensor-title">GYROSCOPE (degrees/sec)</div>
      <div class="data">
        <div class="data-item">
          <div class="data-label">X Rotation</div>
          <div class="data-value" id="gyroX">0.00</div>
        </div>
        <div class="data-item">
          <div class="data-label">Y Rotation</div>
          <div class="data-value" id="gyroY">0.00</div>
        </div>
        <div class="data-item">
          <div class="data-label">Z Rotation</div>
          <div class="data-value" id="gyroZ">0.00</div>
        </div>
        <div class="data-item">
          <div class="data-label">Total Spin</div>
          <div class="data-value" id="gyroMag">0.00</div>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <h3>3. Tone.js Audio Engine</h3>
    
    <button onclick="startAudio()">üéôÔ∏è Start Audio</button>
    <button onclick="stopAudio()">‚èπÔ∏è Stop Audio</button>

    <div class="tone-section">
      <div class="tone-control">
        <label>Synth Volume</label>
        <input type="range" id="synthVolume" min="-60" max="0" value="-20" onchange="updateSynthVolume(this.value)">
        <span id="synthVolumeVal">-20 dB</span>
      </div>

      <div class="tone-control">
        <label>Filter Cutoff</label>
        <input type="range" id="filterCutoff" min="100" max="4000" value="1000" onchange="updateFilterCutoff(this.value)">
        <span id="filterCutoffVal">1000 Hz</span>
      </div>

      <div class="tone-control">
        <label>LFO Speed</label>
        <input type="range" id="lfoSpeed" min="0.1" max="10" step="0.1" value="2" onchange="updateLfoSpeed(this.value)">
        <span id="lfoSpeedVal">2 Hz</span>
      </div>

      <div class="tone-control">
        <label>Reverb Mix</label>
        <input type="range" id="reverbMix" min="0" max="1" step="0.1" value="0.3" onchange="updateReverbMix(this.value)">
        <span id="reverbMixVal">0.3</span>
      </div>
    </div>
  </div>

  <div class="container">
    <h3>4. Use Cases & Examples</h3>

    <div class="code-box">
      <strong>üéπ Tilt to Pitch</strong>
      <div class="code-example">
// Tilt left/right controls pitch
// Pitch range: C3 to C5
const baseFreq = 130.8; // C3
const pitchRange = 261.63 - 130.8; // C3 to C5
synth.frequency.value = baseFreq + (window.accelX + 1) * (pitchRange / 2);</div>
    </div>

    <div class="code-box">
      <strong>üéöÔ∏è Shake to Filter</strong>
      <div class="code-example">
// Shake (acceleration magnitude) opens/closes filter
const filterValue = 500 + window.accelMag * 1500;
filter.frequency.value = Math.min(filterValue, 4000);</div>
    </div>

    <div class="code-box">
      <strong>üéõÔ∏è Spin to Modulation</strong>
      <div class="code-example">
// Spin controls vibrato rate
lfo.frequency.value = Math.abs(window.gyroZ) * 0.5;</div>
    </div>

    <div class="code-box">
      <strong>ü•Å Impact Trigger</strong>
      <div class="code-example">
// Strong downward movement triggers a hit
if (window.accelZ > 1.5) {
  envelope.triggerAttackRelease("8n");
}</div>
    </div>

    <div class="code-box">
      <strong>üåä Full Integration Example</strong>
      <div class="code-example">
// In your loop or update function:
function updateToneFromSensors() {
  // Pitch from X tilt
  synth.frequency.value = 200 + window.accelX * 200;
  
  // Filter from acceleration
  filter.frequency.value = 500 + window.accelMag * 1000;
  
  // Vibrato from spin
  lfo.frequency.value = Math.abs(window.gyroZ) * 0.5;
  
  // Volume from Y tilt
  synth.volume.value = window.accelY * 20 - 10;
}</div>
    </div>
  </div>

  <script src="GY-87_tonejs.js"></script>
</body>
</html>
